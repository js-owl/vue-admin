<template>
  <div class="app-container flowchart_edit sticky_edit">
    <el-row :gutter="20">
      <el-col :span="12">
        <div class="editOperation_edit_card">
          <div class="box">
            <el-card class="box-card">
              <template #header>
                <div class="card-header">
                  <p class="title">–ò–ó–ú–ï–ù–ò–¢–¨ –°–ü–ò–°–û–ö –ì–†–£–ü–ü –≠–õ–ï–ö–¢–†–û–°–•–ï–ú</p>
                  <el-button type="primary" @click="addRootItem()">
                    –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–µ–Ω—å
                  </el-button>
                </div>
              </template>
              <el-tree
                :allow-drag="allowDrag"
                :allow-drop="allowDrop"
                :data="structureFlowchart"
                :props="defaultProps"
                draggable
                node-key="flowChartItem_id"
                @node-drop="handleDrop"
              >
                <template #default="{ node, data }">
                  <span class="custom-tree-node structure_flowchart_table">
                    <span class="emaps-label">
                      {{ node.label }}
                    </span>
                    <!-- –ö–Ω–æ–ø–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
                    <span style="display: flex">
                      <!-- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç -->
                      <el-tooltip
                        class="box-item"
                        effect="light"
                        placement="top-start"
                        content="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç"
                        popper-class="uaz__tooltip uaz__tooltip-left"
                      >
                        <el-button
                          size="mini"
                          class="el-button-icon"
                          @click="editItem(node, data)"
                        >
                          <i class="el-icon-edit-outline" />
                        </el-button>
                      </el-tooltip>
                      <!-- –î–æ–±–∞–≤–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç -->
                      <el-tooltip
                        class="box-item"
                        effect="light"
                        placement="top-start"
                        content="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç"
                        popper-class="uaz__tooltip uaz__tooltip-left"
                      >
                        <el-button
                          size="mini"
                          class="el-button-icon"
                          @click="addItem(node, data)"
                        >
                          +
                        </el-button>
                      </el-tooltip>
                      <!-- –£–¥–∞–ª–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç -->
                      <el-popconfirm
                        confirm-button-text="–î–∞"
                        cancel-button-text="–ù–µ—Ç, —Å–ø–∞—Å–∏–±–æ"
                        title="–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç–µ —É–¥–∞–ª–µ–Ω–∏–µ?"
                        @onConfirm="deleteItem(node, data)"
                      >
                        <template #reference>
                          <el-tooltip
                            class="box-item"
                            effect="light"
                            placement="top-start"
                            content="–£–¥–∞–ª–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç"
                            popper-class="uaz__tooltip uaz__tooltip-left"
                          >
                            <el-button
                              size="mini"
                              class="el-button-icon danger"
                            >
                              <i class="el-icon-delete" />
                            </el-button>
                          </el-tooltip>
                        </template>
                      </el-popconfirm>
                    </span>
                  </span>
                </template>
              </el-tree>
            </el-card>
          </div>
        </div>
      </el-col>
      <el-col :span="12">
        <div class="editOperation_edit_card">
          <div class="box">
            <el-card class="box-card">
              <template #header>
                <div class="card-header">
                  <p class="title">–≠–õ–ï–ö–¢–†–ò–ß–ï–°–ö–ò–ï –ü–†–ò–ù–¶–ò–ü–ò–ê–õ–¨–ù–´–ï –°–•–ï–ú–´</p>
                </div>
              </template>
              <div class="emaps-body">–≠–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>
            </el-card>
            <el-card class="box-card">
              <template #header>
                <div class="card-header">
                  <p class="title">–†–ê–°–ü–û–õ–û–ñ–ï–ù–ò–ï –ö–û–ú–ü–û–ù–ï–ù–¢–û–í</p>
                </div>
              </template>
              <div class="emaps-body">–≠–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>
            </el-card>
            <el-card class="box-card">
              <template #header>
                <div class="card-header">
                  <p class="title">–°–•–ï–ú–´ –†–ê–ó–™–ï–ú–û–í</p>
                </div>
              </template>
              <div class="emaps-body">–≠–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>
            </el-card>
          </div>
        </div>
      </el-col>
    </el-row>
    <emaps-group-dialog
      v-if="isModalOpen"
      :open.sync="isModalOpen"
      :data.sync="modalData"
    />
  </div>
</template>

<script>
import request from '@/utils/request'
import EmapsGroupDialog from '@/components/Dialog/EmapsGroupDialog'

export default {
  components: { EmapsGroupDialog },
  data() {
    return {
      defaultProps: {
        label: 'flowChartItem_name',
        children: 'nodes'
      },
      structureFlowchart: [],
      // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç
      isModalOpen: false,
      modalData: {}
    }
  },

  async mounted() {
    this.getInfo()
  },
  methods: {
    async getInfo() {
      const res = await request({
        url: '/flowchart/get/5879',
        method: 'get',
        params: { toHierarchy: true }
      })
      this.formData = res.data
      this.structureFlowchart = this.formData.items
    },
    allowDrag() {},
    allowDrop() {},
    handleDrop() {},
    addRootItem() {},
    editItem(node, data) {
      Object.assign(this.modalData, data)
      console.log('üöÄ ~ editItem ~ this.modalData:', this.modalData)
      this.isModalOpen = true
    },
    addItem() {},
    deleteItem() {}
  }
}
</script>
<style scoped>
.card-header {
  display: flex;
  justify-content: space-between;
}
.el-form-item {
  margin: 0 20px 0 0;
  height: 72px;
}
.custom-tree-node {
  margin: 10px;
  /* padding: 10px; */
  width: 1000px;
  border: 1px black solid;
  cursor: move;
}
.structure_flowchart_table {
  display: flex;
  justify-content: space-between;
  width: 100%;
  border: 0;
  margin: 0px;
  padding: 2px 0;
}
.structure_flowchart_table .el-button {
  margin-left: 2px;
}
.emaps-label {
  white-space: normal;
}
.emaps-body {
  padding: 0 0 100px;
}
</style>
